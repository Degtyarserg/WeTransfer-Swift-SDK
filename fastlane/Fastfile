import "./../Submodules/WeTransfer-iOS-CI/Fastlane/Fastfile"

desc "Clean the derived data, run tests validate the changes"
lane :test do |options|
  # clear_derived_data

  # Set timeout to prevent xcodebuild -list -project to take to much retries.
  ENV["FASTLANE_XCODE_LIST_TIMEOUT"] = "120"

  scan(
    scheme: options[:project_name],
    project: "#{options[:project_name]}.xcodeproj",
    device: "iPhone 7",
    clean: true,
    code_coverage: true,
    formatter: "xcpretty-json-formatter"
  )

  validate_changes(project_name: options[:project_name])
end
